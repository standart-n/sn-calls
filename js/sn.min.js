(function($){var methods={init:function(options){return options||(options={}),def={content:{},result:{key:""}},$.extend(!0,def,options),this.each(function(){$(this).data("sn",def),$(this).snTriggers(),""!==$("#controls").html()&&$(this).snEvents({href:"#autoload"})})}};$.fn.sn=function(sn){return sn||(sn={}),methods[sn]?methods[sn].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof sn&&sn?($.error("Метод "+sn+" не существует"),void 0):methods.init.apply(this,arguments)}})(jQuery),function($){var methods={init:function(){return this.each(function(){})},sendRequest:function(options){options||(options={});var def={type:"json",debug:!1,action:"submit",src:$("#src").val(),dst:$("#dst").val(),date1:$("#date1").val(),date2:$("#date2").val(),page:$("#page").val(),limit:$("#limit").val(),order:$("#order").val(),grad:$("#grad").val(),login:$("#inputLogin").val(),password:$("#inputPassword").val(),phone:"",show_short_calls:$("#show_short_calls").val(),show_answered:$("#show_answered").val(),show_no_answer:$("#show_no_answer").val(),show_busy:$("#show_busy").val(),show_failed:$("#show_failed").val(),show_hangup:$("#show_hangup").val(),show_playback:$("#show_playback").val(),show_dial:$("#show_dial").val(),show_wait:$("#show_wait").val()};$.extend(!0,def,options),def.debug&&(def.type="text");var sn=$(this).data("sn");$.ajax({url:"index.php",type:"POST",data:{action:def.action,src:def.src,dst:def.dst,date1:def.date1,date2:def.date2,page:def.page,limit:def.limit,order:def.order,grad:def.grad,login:def.login,password:def.password,phone:def.phone,show_short_calls:def.show_short_calls,show_answered:def.show_answered,show_no_answer:def.show_no_answer,show_busy:def.show_busy,show_failed:def.show_failed,show_hangup:def.show_hangup,show_playback:def.show_playback,show_dial:def.show_dial,show_wait:def.show_wait,key:sn.result.key},dataType:def.type,timeout:1e4,beforeSend:function(){$("#loading").show()},success:function(s){"object"==typeof s?$.extend(!0,sn.result,s):(def.debug&&alert(s),sn.result=s),$(this).data("sn",sn),"object"==typeof sn.result&&(sn.result.alert&&alert(sn.result.alert),sn.result.callback&&$(this).snEvents({href:"#"+sn.result.callback})),$("#loading").hide()},error:function(){}})}};$.fn.snAjax=function(sn){return sn||(sn={}),methods[sn]?methods[sn].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof sn&&sn?($.error("Метод "+sn+" не существует"),void 0):methods.init.apply(this,arguments)}}(jQuery),function($){var methods={init:function(){$(this).snPlayer("onClickPlay"),$(this).snPlayer("onClickClose")},onClickClose:function(){$("#player-close").click(function(e){e.preventDefault(),$("#player-wrap").hide()})},onClickPlay:function(){$("a.play").click(function(e){e.preventDefault();var id=$(this).data("id"),src=$(this).data("src");$("#player-wrap").show(),$("#player").html("<audio/>").data("id",id),audiojs.events.ready(function(){var a=audiojs.createAll({}),audio=a[0];$("#player-close").click(function(e){e.preventDefault(),audio.pause(),$("#player").html("")}),audio.load(src),audio.play()})})},fixPlayer:function(){$("#player-wrap").css({top:window.pageYOffset+$(window).height()-36+"px"})}};$.fn.snPlayer=function(sn){return sn||(sn={}),methods[sn]?methods[sn].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof sn&&sn?($.error("Метод "+sn+" не существует"),void 0):methods.init.apply(this,arguments)}}(jQuery),function($){var methods={init:function(){return this.each(function(){$(this).snConf("main")})},main:function(){var sn=$(this).data("sn");$.ajax({url:"sn-project/settings/main.json",async:!1,dataType:"json",success:function(s){$.extend(!0,sn,s),$(this).data("sn",sn)}})}};$.fn.snConf=function(sn){return sn||(sn={}),methods[sn]?methods[sn].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof sn&&sn?($.error("Метод "+sn+" не существует"),void 0):methods.init.apply(this,arguments)}}(jQuery),function($){var methods={init:function(options){return this.each(function(){var def={href:"none"};$.extend(!0,def,options);var th=$(this),sn=$(this).data("sn"),href=def.href;switch(href.replace(/(.*)#(.*)/,"$2")){case"autoload":$("#dp1").datepicker(),$("#dp2").datepicker(),$(this).snPlayer(),$(this).snEvents({href:"#fbRequest"});break;case"signin":$("#signin-error").hide(),$(this).snAjax("sendRequest",{action:"signin",debug:!1});break;case"afterSignin":sn.result&&(sn.result.response?(sn.result.controls&&$("#controls").html(sn.result.controls),$("#signin").empty(),$(this).snTriggers("controls"),$(this).snEvents({href:"#submit"})):($("#inputLogin").val(""),$("#inputPassword").val(""),$("#signin-error").show()));break;case"submit":$(this).snAjax("sendRequest",{action:"submit",debug:!1});break;case"afterSubmit":sn.result&&(sn.result.table&&($("#table").html(sn.result.table),$(this).snTriggers("sort"),$(this).snPlayer("onClickPlay")),sn.result.stat&&$("#stat").html(sn.result.stat),sn.result.pagination&&($("#pagination").html(sn.result.pagination),$(this).snTriggers("list")),$(this).snEvents({href:"#fbRequest"}));break;case"fbRequest":$(".no-fb").each(function(){""!==$(this).val()&&(th.snAjax("sendRequest",{action:"fbRequest",phone:$(this).val(),debug:!1}),$(this).removeClass("no-fb"))});break;case"afterFbRequest":sn.result&&sn.result.response&&sn.result.response.hash&&$("."+sn.result.response.hash).html(sn.result.response.caption);break;case"close":$(this).hide()}})}};$.fn.snEvents=function(sn){return sn||(sn={}),methods[sn]?methods[sn].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof sn&&sn?($.error("Метод "+sn+" не существует"),void 0):methods.init.apply(this,arguments)}}(jQuery),function($){var methods={init:function(){""!==$("#controls").html()&&($(this).snTriggers("submit"),$(this).snTriggers("cb"),$(this).snTriggers("limit"),$(this).snTriggers("filters")),""!==$("#talbe").html()&&$(this).snTriggers("sort"),""!==$("#pagination").html()&&$(this).snTriggers("list"),""!==$("#signin").html()&&$(this).snTriggers("signin")},controls:function(){$(this).snTriggers("submit"),$(this).snTriggers("cb"),$(this).snTriggers("limit"),$(this).snTriggers("filters")},signin:function(){th=$(this),$("#fSignin").on("submit",function(e){e.preventDefault(),th.snEvents({href:"#signin"})})},submit:function(){th=$(this),$("#fSubmit").on("submit",function(e){e.preventDefault(),$("#page").val(1),th.snEvents({href:"#submit"})}),$("#submit").on("click",function(e){e.preventDefault(),$("#page").val(1),th.snEvents({href:"#submit"})})},cb:function(){th=$(this),$(".cb").on("click",function(e){e.preventDefault(),$(this).is(":checked")?$("#"+$(this).data("cb")).val("on"):$("#"+$(this).data("cb")).val("off"),$("#page").val(1),th.snEvents({href:"#submit"})})},limit:function(){th=$(this),sn=$(this).data("sn"),$(".limit a").on("click",function(e){e.preventDefault(),$(this).addClass("active").siblings().removeClass("active"),$("#limit").val($(this).data("limit")),$("#page").val(1),th.snEvents({href:"#submit"})})},filters:function(){th=$(this),$(".filters li a").on("click",function(e){e.preventDefault(),"on"==$(this).data("value")?($("i",this).removeClass("icon-ok").addClass("icon-none"),$(this).data("value","off"),$("#"+$(this).data("cb")).val("off")):($("i",this).removeClass("icon-none").addClass("icon-ok"),$(this).data("value","on"),$("#"+$(this).data("cb")).val("on")),$("#page").val(1),th.snEvents({href:"#submit"})})},sort:function(){th=$(this),$("a.sort").on("click",function(e){e.preventDefault(),$("#order").val($(this).data("order")),$("#grad").val($(this).data("grad")),$("#page").val(1),th.snEvents({href:"#submit"})})},list:function(){th=$(this),$("a#prev").on("click",function(e){e.preventDefault(),$("#page").val(1*$("#page").val()-1),th.snEvents({href:"#submit"})}),$("a.list").on("click",function(e){e.preventDefault(),$("#page").val($(this).data("page")),th.snEvents({href:"#submit"})}),$("a#next").on("click",function(e){e.preventDefault(),$("#page").val(1*$("#page").val()+1),th.snEvents({href:"#submit"})})}};$.fn.snTriggers=function(sn){return sn||(sn={}),methods[sn]?methods[sn].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof sn&&sn?($.error("Метод "+sn+" не существует"),void 0):methods.init.apply(this,arguments)}}(jQuery);